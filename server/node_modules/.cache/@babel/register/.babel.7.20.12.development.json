{"{\"assumptions\":{},\"sourceRoot\":\"/Users/vyacheslavsokolov/Dropbox/marketplace_parcer/server/\",\"caller\":{\"name\":\"@babel/node\"},\"cwd\":\"/Users/vyacheslavsokolov/Dropbox/marketplace_parcer/server\",\"filename\":\"/Users/vyacheslavsokolov/Dropbox/marketplace_parcer/server/index.js\",\"targets\":{},\"cloneInputAst\":true,\"babelrc\":false,\"configFile\":false,\"browserslistConfigFile\":false,\"passPerPreset\":false,\"envName\":\"development\",\"root\":\"/Users/vyacheslavsokolov/Dropbox/marketplace_parcer/server\",\"rootMode\":\"root\",\"plugins\":[],\"presets\":[]}:7.20.12:development":{"value":{"code":"const express = require('express');\nconst puppeteer = require('puppeteer');\nrequire('dotenv').config();\nconst cheerio = require('cheerio');\n\n////////////////////////////////////\n\nconst app = express();\napp.use(express.json());\napp.listen(process.env.PORT, () => {\n  console.log(`Server started on ${process.env.PORT} port`);\n});\napp.get('/getupdates', async (req, res) => {\n  if (req.query.processor) {\n    const result = await lib.getItemsProc(req.query.processor, elements);\n    res.json({\n      status: \"ok\",\n      data: result\n    });\n  }\n  res.status(403).json({\n    status: \"error\",\n    message: \"endpoint forbidden\"\n  });\n});\n\n/////////////////\n\nclass PuppeteerHandler {\n  constructor() {\n    this.browser = null;\n  }\n  async initBrowser() {\n    // this.browser = await puppeteer.launch(LAUNCH_PUPPETEER_OPTS);\n    this.browser = await puppeteer.launch({\n      headless: false,\n      slowMo: 100\n      // devtools: true\n    });\n  }\n\n  closeBrowser() {\n    this.browser.close();\n  }\n  async getPageContent(url, selector) {\n    if (!this.browser) {\n      await this.initBrowser();\n    }\n    try {\n      const page = await this.browser.newPage();\n      console.log('stage1');\n      await page.goto(url, PAGE_PUPPETEER_OPTS);\n      console.log('stage2');\n      await page.waitForSelector(selector);\n      console.log('stage3');\n      const content = await page.content();\n      page.close();\n      return cheerio.load(content);\n    } catch (err) {\n      throw err;\n    }\n  }\n  async getItemsProc(processor, elements) {\n    const processors = [];\n    for (let el of elements) {\n      try {\n        const $ = await lib.getPageContent(el.url(processor), el.selector);\n        // const sep = `${el.selector.split('.')[0]}[class=${el.selector.split('.')[1]}]`\n        const arr = el.getItems($, el.selector);\n        processors.push(...arr);\n        // $(el.selector).each(function (i, element) {\n        //     const title = $(element).find(\"a.catalog-product__name>span\").text()\n        //     const link = \"https://dns-shop.ru\" + $(element).find(\"a.catalog-product__name\").attr(\"href\")\n        //     const price = Number($(element).find(\"div.product-buy__price\").text().match(/\\d/gm).join(''))\n        //\n        //     processors.push({\n        //         title, link, price\n        //     })\n        // })\n\n        // const all = $\n        // all.each((i, elem) => {\n        //     const div = $(this).text()\n        //     processors.push(div)\n        // })\n      } catch (e) {\n        console.log('oshibka', e);\n      }\n    }\n    return processors;\n  }\n}\nconst PAGE_PUPPETEER_OPTS = {\n  networkIdle2Timeout: 5000,\n  waitUntil: 'networkidle2',\n  timeout: 3000000\n};\nconst LAUNCH_PUPPETEER_OPTS = {\n  args: ['--no-sandbox', '--disable-setuid-sandbox', '--disable-dev-shm-usage', '--disable-accelerated-2d-canvas', '--disable-gpu', '--window-size=1920x1080']\n};\nconst lib = new PuppeteerHandler();\nconst elements = [{\n  url: processor => `https://www.dns-shop.ru/catalog/17a899cd16404e77/processory/?order=6&q=${processor}`,\n  selector: \"div.catalog-product\",\n  getItems: function ($, selector) {\n    const processors = [];\n    $(selector).each(function (i, element) {\n      const title = $(element).find(\"a.catalog-product__name>span\").text();\n      const link = \"https://dns-shop.ru\" + $(element).find(\"a.catalog-product__name\").attr(\"href\");\n      const price = Number($(element).find(\"div.product-buy__price\").text().match(/\\d/gm).join(''));\n      processors.push({\n        title,\n        link,\n        price\n      });\n    });\n    return processors;\n  }\n}, {\n  url: processor => `https://www.wildberries.ru/catalog/0/search.aspx?page=1&sort=popular&search=${processor}&fbrand=21223`,\n  selector: \"div.product-card__wrapper\",\n  getItems: function ($, selector) {\n    const processors = [];\n    $(selector).each(function (i, element) {\n      const title = $(element).find(\"span.goods-name\").text();\n      const link = $(element).find(\"a.product-card__main\").attr(\"href\");\n      const price = Number($(element).find(\"ins.price__lower-price\").text().match(/\\d/gm).join(''));\n      processors.push({\n        title,\n        link,\n        price\n      });\n    });\n    return processors;\n  }\n}, {\n  url: processor => `https://www.citilink.ru/search/?text=${processor}&menu_id=26&pf=&f=intel`,\n  selector: \"div.product_data__gtm-js\",\n  getItems: function ($, selector) {\n    const processors = [];\n    $(selector).each(function (i, element) {\n      const title = $(element).find(\"a.ProductCardVertical__name\").text();\n      const link = \"https://www.citilink.ru\" + $(element).find(\"a.ProductCardVertical__name\").attr(\"href\");\n      const price = Number($(element).find(\"div.ProductCardVerticalLayout__wrapper-price\").find(\"span.ProductCardVerticalPrice__price-current_current-price\").text().match(/\\d/gm).join(''));\n      processors.push({\n        title,\n        link,\n        price\n      });\n    });\n    return processors;\n  }\n}];\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJleHByZXNzIiwicmVxdWlyZSIsInB1cHBldGVlciIsImNvbmZpZyIsImNoZWVyaW8iLCJhcHAiLCJ1c2UiLCJqc29uIiwibGlzdGVuIiwicHJvY2VzcyIsImVudiIsIlBPUlQiLCJjb25zb2xlIiwibG9nIiwiZ2V0IiwicmVxIiwicmVzIiwicXVlcnkiLCJwcm9jZXNzb3IiLCJyZXN1bHQiLCJsaWIiLCJnZXRJdGVtc1Byb2MiLCJlbGVtZW50cyIsInN0YXR1cyIsImRhdGEiLCJtZXNzYWdlIiwiUHVwcGV0ZWVySGFuZGxlciIsImNvbnN0cnVjdG9yIiwiYnJvd3NlciIsImluaXRCcm93c2VyIiwibGF1bmNoIiwiaGVhZGxlc3MiLCJzbG93TW8iLCJjbG9zZUJyb3dzZXIiLCJjbG9zZSIsImdldFBhZ2VDb250ZW50IiwidXJsIiwic2VsZWN0b3IiLCJwYWdlIiwibmV3UGFnZSIsImdvdG8iLCJQQUdFX1BVUFBFVEVFUl9PUFRTIiwid2FpdEZvclNlbGVjdG9yIiwiY29udGVudCIsImxvYWQiLCJlcnIiLCJwcm9jZXNzb3JzIiwiZWwiLCIkIiwiYXJyIiwiZ2V0SXRlbXMiLCJwdXNoIiwiZSIsIm5ldHdvcmtJZGxlMlRpbWVvdXQiLCJ3YWl0VW50aWwiLCJ0aW1lb3V0IiwiTEFVTkNIX1BVUFBFVEVFUl9PUFRTIiwiYXJncyIsImVhY2giLCJpIiwiZWxlbWVudCIsInRpdGxlIiwiZmluZCIsInRleHQiLCJsaW5rIiwiYXR0ciIsInByaWNlIiwiTnVtYmVyIiwibWF0Y2giLCJqb2luIl0sInNvdXJjZVJvb3QiOiIvVXNlcnMvdnlhY2hlc2xhdnNva29sb3YvRHJvcGJveC9tYXJrZXRwbGFjZV9wYXJjZXIvc2VydmVyLyIsInNvdXJjZXMiOlsiaW5kZXguanMiXSwic291cmNlc0NvbnRlbnQiOlsiY29uc3QgZXhwcmVzcyA9IHJlcXVpcmUoJ2V4cHJlc3MnKVxuY29uc3QgcHVwcGV0ZWVyID0gcmVxdWlyZSgncHVwcGV0ZWVyJylcbnJlcXVpcmUoJ2RvdGVudicpLmNvbmZpZygpXG5jb25zdCBjaGVlcmlvID0gcmVxdWlyZSgnY2hlZXJpbycpXG5cbi8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xuXG5jb25zdCBhcHAgPSBleHByZXNzKClcbmFwcC51c2UoZXhwcmVzcy5qc29uKCkpXG5cbmFwcC5saXN0ZW4ocHJvY2Vzcy5lbnYuUE9SVCwgKCkgPT4ge1xuICAgIGNvbnNvbGUubG9nKGBTZXJ2ZXIgc3RhcnRlZCBvbiAke3Byb2Nlc3MuZW52LlBPUlR9IHBvcnRgKVxufSlcblxuYXBwLmdldCgnL2dldHVwZGF0ZXMnLCBhc3luYyAocmVxLCByZXMpID0+IHtcbiAgICBpZiAocmVxLnF1ZXJ5LnByb2Nlc3Nvcikge1xuICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBsaWIuZ2V0SXRlbXNQcm9jKHJlcS5xdWVyeS5wcm9jZXNzb3IsIGVsZW1lbnRzKVxuICAgICAgICByZXMuanNvbih7c3RhdHVzOiBcIm9rXCIsIGRhdGE6IHJlc3VsdH0pXG4gICAgfVxuICAgIHJlcy5zdGF0dXMoNDAzKS5qc29uKHtzdGF0dXM6IFwiZXJyb3JcIiwgbWVzc2FnZTogXCJlbmRwb2ludCBmb3JiaWRkZW5cIn0pXG59KVxuXG4vLy8vLy8vLy8vLy8vLy8vL1xuXG5jbGFzcyBQdXBwZXRlZXJIYW5kbGVyIHtcbiAgICBjb25zdHJ1Y3RvcigpIHtcbiAgICAgICAgdGhpcy5icm93c2VyID0gbnVsbDtcbiAgICB9XG4gICAgYXN5bmMgaW5pdEJyb3dzZXIoKSB7XG4gICAgICAgIC8vIHRoaXMuYnJvd3NlciA9IGF3YWl0IHB1cHBldGVlci5sYXVuY2goTEFVTkNIX1BVUFBFVEVFUl9PUFRTKTtcbiAgICAgICAgdGhpcy5icm93c2VyID0gYXdhaXQgcHVwcGV0ZWVyLmxhdW5jaCh7XG4gICAgICAgICAgICBoZWFkbGVzczogZmFsc2UsXG4gICAgICAgICAgICBzbG93TW86IDEwMCxcbiAgICAgICAgICAgIC8vIGRldnRvb2xzOiB0cnVlXG4gICAgICAgIH0pO1xuICAgIH1cbiAgICBjbG9zZUJyb3dzZXIoKSB7XG4gICAgICAgIHRoaXMuYnJvd3Nlci5jbG9zZSgpO1xuICAgIH1cbiAgICBhc3luYyBnZXRQYWdlQ29udGVudCh1cmwsIHNlbGVjdG9yKSB7XG4gICAgICAgIGlmICghdGhpcy5icm93c2VyKSB7XG4gICAgICAgICAgICBhd2FpdCB0aGlzLmluaXRCcm93c2VyKCk7XG4gICAgICAgIH1cblxuICAgICAgICB0cnkge1xuICAgICAgICAgICAgY29uc3QgcGFnZSA9IGF3YWl0IHRoaXMuYnJvd3Nlci5uZXdQYWdlKCk7XG4gICAgICAgICAgICBjb25zb2xlLmxvZygnc3RhZ2UxJylcbiAgICAgICAgICAgIGF3YWl0IHBhZ2UuZ290byh1cmwsIFBBR0VfUFVQUEVURUVSX09QVFMpO1xuICAgICAgICAgICAgY29uc29sZS5sb2coJ3N0YWdlMicpXG4gICAgICAgICAgICBhd2FpdCBwYWdlLndhaXRGb3JTZWxlY3RvcihzZWxlY3RvcilcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdzdGFnZTMnKVxuICAgICAgICAgICAgY29uc3QgY29udGVudCA9IGF3YWl0IHBhZ2UuY29udGVudCgpXG4gICAgICAgICAgICBwYWdlLmNsb3NlKClcbiAgICAgICAgICAgIHJldHVybiBjaGVlcmlvLmxvYWQoY29udGVudClcbiAgICAgICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICAgICAgICB0aHJvdyBlcnI7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBhc3luYyBnZXRJdGVtc1Byb2MocHJvY2Vzc29yLCBlbGVtZW50cykge1xuICAgICAgICBjb25zdCBwcm9jZXNzb3JzID0gW11cbiAgICAgICAgZm9yKGxldCBlbCBvZiBlbGVtZW50cykge1xuICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICBjb25zdCAkID0gYXdhaXQgbGliLmdldFBhZ2VDb250ZW50KGVsLnVybChwcm9jZXNzb3IpLCBlbC5zZWxlY3RvcilcbiAgICAgICAgICAgICAgICAvLyBjb25zdCBzZXAgPSBgJHtlbC5zZWxlY3Rvci5zcGxpdCgnLicpWzBdfVtjbGFzcz0ke2VsLnNlbGVjdG9yLnNwbGl0KCcuJylbMV19XWBcbiAgICAgICAgICAgICAgICBjb25zdCBhcnIgPSBlbC5nZXRJdGVtcygkLCBlbC5zZWxlY3RvcilcbiAgICAgICAgICAgICAgICBwcm9jZXNzb3JzLnB1c2goLi4uYXJyKVxuICAgICAgICAgICAgICAgIC8vICQoZWwuc2VsZWN0b3IpLmVhY2goZnVuY3Rpb24gKGksIGVsZW1lbnQpIHtcbiAgICAgICAgICAgICAgICAvLyAgICAgY29uc3QgdGl0bGUgPSAkKGVsZW1lbnQpLmZpbmQoXCJhLmNhdGFsb2ctcHJvZHVjdF9fbmFtZT5zcGFuXCIpLnRleHQoKVxuICAgICAgICAgICAgICAgIC8vICAgICBjb25zdCBsaW5rID0gXCJodHRwczovL2Rucy1zaG9wLnJ1XCIgKyAkKGVsZW1lbnQpLmZpbmQoXCJhLmNhdGFsb2ctcHJvZHVjdF9fbmFtZVwiKS5hdHRyKFwiaHJlZlwiKVxuICAgICAgICAgICAgICAgIC8vICAgICBjb25zdCBwcmljZSA9IE51bWJlcigkKGVsZW1lbnQpLmZpbmQoXCJkaXYucHJvZHVjdC1idXlfX3ByaWNlXCIpLnRleHQoKS5tYXRjaCgvXFxkL2dtKS5qb2luKCcnKSlcbiAgICAgICAgICAgICAgICAvL1xuICAgICAgICAgICAgICAgIC8vICAgICBwcm9jZXNzb3JzLnB1c2goe1xuICAgICAgICAgICAgICAgIC8vICAgICAgICAgdGl0bGUsIGxpbmssIHByaWNlXG4gICAgICAgICAgICAgICAgLy8gICAgIH0pXG4gICAgICAgICAgICAgICAgLy8gfSlcblxuICAgICAgICAgICAgICAgIC8vIGNvbnN0IGFsbCA9ICRcbiAgICAgICAgICAgICAgICAvLyBhbGwuZWFjaCgoaSwgZWxlbSkgPT4ge1xuICAgICAgICAgICAgICAgIC8vICAgICBjb25zdCBkaXYgPSAkKHRoaXMpLnRleHQoKVxuICAgICAgICAgICAgICAgIC8vICAgICBwcm9jZXNzb3JzLnB1c2goZGl2KVxuICAgICAgICAgICAgICAgIC8vIH0pXG4gICAgICAgICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ29zaGlia2EnLCBlKVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBwcm9jZXNzb3JzXG4gICAgfVxufVxuXG5jb25zdCBQQUdFX1BVUFBFVEVFUl9PUFRTID0ge1xuICAgIG5ldHdvcmtJZGxlMlRpbWVvdXQ6IDUwMDAsXG4gICAgd2FpdFVudGlsOiAnbmV0d29ya2lkbGUyJyxcbiAgICB0aW1lb3V0OiAzMDAwMDAwXG59O1xuXG5jb25zdCBMQVVOQ0hfUFVQUEVURUVSX09QVFMgPSB7XG4gICAgYXJnczogW1xuICAgICAgICAnLS1uby1zYW5kYm94JyxcbiAgICAgICAgJy0tZGlzYWJsZS1zZXR1aWQtc2FuZGJveCcsXG4gICAgICAgICctLWRpc2FibGUtZGV2LXNobS11c2FnZScsXG4gICAgICAgICctLWRpc2FibGUtYWNjZWxlcmF0ZWQtMmQtY2FudmFzJyxcbiAgICAgICAgJy0tZGlzYWJsZS1ncHUnLFxuICAgICAgICAnLS13aW5kb3ctc2l6ZT0xOTIweDEwODAnXG4gICAgXVxufTtcblxuY29uc3QgbGliID0gbmV3IFB1cHBldGVlckhhbmRsZXJcblxuY29uc3QgZWxlbWVudHMgPSBbXG4gICAge1xuICAgICAgICB1cmw6IChwcm9jZXNzb3IpID0+IGBodHRwczovL3d3dy5kbnMtc2hvcC5ydS9jYXRhbG9nLzE3YTg5OWNkMTY0MDRlNzcvcHJvY2Vzc29yeS8/b3JkZXI9NiZxPSR7cHJvY2Vzc29yfWAsXG4gICAgICAgIHNlbGVjdG9yOiBcImRpdi5jYXRhbG9nLXByb2R1Y3RcIixcbiAgICAgICAgZ2V0SXRlbXM6IGZ1bmN0aW9uICgkLCBzZWxlY3Rvcikge1xuICAgICAgICAgICAgY29uc3QgcHJvY2Vzc29ycyA9IFtdXG4gICAgICAgICAgICAkKHNlbGVjdG9yKS5lYWNoKGZ1bmN0aW9uIChpLCBlbGVtZW50KSB7XG4gICAgICAgICAgICAgICAgY29uc3QgdGl0bGUgPSAkKGVsZW1lbnQpLmZpbmQoXCJhLmNhdGFsb2ctcHJvZHVjdF9fbmFtZT5zcGFuXCIpLnRleHQoKVxuICAgICAgICAgICAgICAgIGNvbnN0IGxpbmsgPSBcImh0dHBzOi8vZG5zLXNob3AucnVcIiArICQoZWxlbWVudCkuZmluZChcImEuY2F0YWxvZy1wcm9kdWN0X19uYW1lXCIpLmF0dHIoXCJocmVmXCIpXG4gICAgICAgICAgICAgICAgY29uc3QgcHJpY2UgPSBOdW1iZXIoJChlbGVtZW50KS5maW5kKFwiZGl2LnByb2R1Y3QtYnV5X19wcmljZVwiKS50ZXh0KCkubWF0Y2goL1xcZC9nbSkuam9pbignJykpXG5cbiAgICAgICAgICAgICAgICBwcm9jZXNzb3JzLnB1c2goe1xuICAgICAgICAgICAgICAgICAgICB0aXRsZSwgbGluaywgcHJpY2VcbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIHJldHVybiBwcm9jZXNzb3JzXG4gICAgICAgIH0sXG4gICAgfSxcbiAgICB7XG4gICAgICAgIHVybDogKHByb2Nlc3NvcikgPT4gYGh0dHBzOi8vd3d3LndpbGRiZXJyaWVzLnJ1L2NhdGFsb2cvMC9zZWFyY2guYXNweD9wYWdlPTEmc29ydD1wb3B1bGFyJnNlYXJjaD0ke3Byb2Nlc3Nvcn0mZmJyYW5kPTIxMjIzYCxcbiAgICAgICAgc2VsZWN0b3I6IFwiZGl2LnByb2R1Y3QtY2FyZF9fd3JhcHBlclwiLFxuICAgICAgICBnZXRJdGVtczogZnVuY3Rpb24gKCQsIHNlbGVjdG9yKSB7XG4gICAgICAgICAgICBjb25zdCBwcm9jZXNzb3JzID0gW11cbiAgICAgICAgICAgICQoc2VsZWN0b3IpLmVhY2goZnVuY3Rpb24gKGksIGVsZW1lbnQpIHtcbiAgICAgICAgICAgICAgICBjb25zdCB0aXRsZSA9ICQoZWxlbWVudCkuZmluZChcInNwYW4uZ29vZHMtbmFtZVwiKS50ZXh0KClcbiAgICAgICAgICAgICAgICBjb25zdCBsaW5rID0gJChlbGVtZW50KS5maW5kKFwiYS5wcm9kdWN0LWNhcmRfX21haW5cIikuYXR0cihcImhyZWZcIilcbiAgICAgICAgICAgICAgICBjb25zdCBwcmljZSA9IE51bWJlcigkKGVsZW1lbnQpLmZpbmQoXCJpbnMucHJpY2VfX2xvd2VyLXByaWNlXCIpLnRleHQoKS5tYXRjaCgvXFxkL2dtKS5qb2luKCcnKSlcblxuICAgICAgICAgICAgICAgIHByb2Nlc3NvcnMucHVzaCh7XG4gICAgICAgICAgICAgICAgICAgIHRpdGxlLCBsaW5rLCBwcmljZVxuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgcmV0dXJuIHByb2Nlc3NvcnNcbiAgICAgICAgfVxuICAgIH0sXG4gICAge1xuICAgICAgICB1cmw6IChwcm9jZXNzb3IpID0+IGBodHRwczovL3d3dy5jaXRpbGluay5ydS9zZWFyY2gvP3RleHQ9JHtwcm9jZXNzb3J9Jm1lbnVfaWQ9MjYmcGY9JmY9aW50ZWxgLFxuICAgICAgICBzZWxlY3RvcjogXCJkaXYucHJvZHVjdF9kYXRhX19ndG0tanNcIixcbiAgICAgICAgZ2V0SXRlbXM6IGZ1bmN0aW9uICgkLCBzZWxlY3Rvcikge1xuICAgICAgICAgICAgY29uc3QgcHJvY2Vzc29ycyA9IFtdXG4gICAgICAgICAgICAkKHNlbGVjdG9yKS5lYWNoKGZ1bmN0aW9uIChpLCBlbGVtZW50KSB7XG4gICAgICAgICAgICAgIGNvbnN0IHRpdGxlID0gJChlbGVtZW50KS5maW5kKFwiYS5Qcm9kdWN0Q2FyZFZlcnRpY2FsX19uYW1lXCIpLnRleHQoKVxuICAgICAgICAgICAgICBjb25zdCBsaW5rID0gXCJodHRwczovL3d3dy5jaXRpbGluay5ydVwiICsgJChlbGVtZW50KS5maW5kKFwiYS5Qcm9kdWN0Q2FyZFZlcnRpY2FsX19uYW1lXCIpLmF0dHIoXCJocmVmXCIpXG4gICAgICAgICAgICAgIGNvbnN0IHByaWNlID0gTnVtYmVyKCQoZWxlbWVudCkuZmluZChcImRpdi5Qcm9kdWN0Q2FyZFZlcnRpY2FsTGF5b3V0X193cmFwcGVyLXByaWNlXCIpLmZpbmQoXCJzcGFuLlByb2R1Y3RDYXJkVmVydGljYWxQcmljZV9fcHJpY2UtY3VycmVudF9jdXJyZW50LXByaWNlXCIpLnRleHQoKS5tYXRjaCgvXFxkL2dtKS5qb2luKCcnKSlcbiAgICAgICAgICAgICAgcHJvY2Vzc29ycy5wdXNoKHtcbiAgICAgICAgICAgICAgICAgIHRpdGxlLCBsaW5rLCBwcmljZVxuICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIHJldHVybiBwcm9jZXNzb3JzXG4gICAgICAgIH1cbiAgICB9XG5dOyJdLCJtYXBwaW5ncyI6IkFBQUEsTUFBTUEsT0FBTyxHQUFHQyxPQUFPLENBQUMsU0FBUyxDQUFDO0FBQ2xDLE1BQU1DLFNBQVMsR0FBR0QsT0FBTyxDQUFDLFdBQVcsQ0FBQztBQUN0Q0EsT0FBTyxDQUFDLFFBQVEsQ0FBQyxDQUFDRSxNQUFNLEVBQUU7QUFDMUIsTUFBTUMsT0FBTyxHQUFHSCxPQUFPLENBQUMsU0FBUyxDQUFDOztBQUVsQzs7QUFFQSxNQUFNSSxHQUFHLEdBQUdMLE9BQU8sRUFBRTtBQUNyQkssR0FBRyxDQUFDQyxHQUFHLENBQUNOLE9BQU8sQ0FBQ08sSUFBSSxFQUFFLENBQUM7QUFFdkJGLEdBQUcsQ0FBQ0csTUFBTSxDQUFDQyxPQUFPLENBQUNDLEdBQUcsQ0FBQ0MsSUFBSSxFQUFFLE1BQU07RUFDL0JDLE9BQU8sQ0FBQ0MsR0FBRyxDQUFFLHFCQUFvQkosT0FBTyxDQUFDQyxHQUFHLENBQUNDLElBQUssT0FBTSxDQUFDO0FBQzdELENBQUMsQ0FBQztBQUVGTixHQUFHLENBQUNTLEdBQUcsQ0FBQyxhQUFhLEVBQUUsT0FBT0MsR0FBRyxFQUFFQyxHQUFHLEtBQUs7RUFDdkMsSUFBSUQsR0FBRyxDQUFDRSxLQUFLLENBQUNDLFNBQVMsRUFBRTtJQUNyQixNQUFNQyxNQUFNLEdBQUcsTUFBTUMsR0FBRyxDQUFDQyxZ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","map":{"version":3,"names":["express","require","puppeteer","config","cheerio","app","use","json","listen","process","env","PORT","console","log","get","req","res","query","processor","result","lib","getItemsProc","elements","status","data","message","PuppeteerHandler","constructor","browser","initBrowser","launch","headless","slowMo","closeBrowser","close","getPageContent","url","selector","page","newPage","goto","PAGE_PUPPETEER_OPTS","waitForSelector","content","load","err","processors","el","$","arr","getItems","push","e","networkIdle2Timeout","waitUntil","timeout","LAUNCH_PUPPETEER_OPTS","args","each","i","element","title","find","text","link","attr","price","Number","match","join"],"sourceRoot":"/Users/vyacheslavsokolov/Dropbox/marketplace_parcer/server/","sources":["index.js"],"sourcesContent":["const express = require('express')\nconst puppeteer = require('puppeteer')\nrequire('dotenv').config()\nconst cheerio = require('cheerio')\n\n////////////////////////////////////\n\nconst app = express()\napp.use(express.json())\n\napp.listen(process.env.PORT, () => {\n    console.log(`Server started on ${process.env.PORT} port`)\n})\n\napp.get('/getupdates', async (req, res) => {\n    if (req.query.processor) {\n        const result = await lib.getItemsProc(req.query.processor, elements)\n        res.json({status: \"ok\", data: result})\n    }\n    res.status(403).json({status: \"error\", message: \"endpoint forbidden\"})\n})\n\n/////////////////\n\nclass PuppeteerHandler {\n    constructor() {\n        this.browser = null;\n    }\n    async initBrowser() {\n        // this.browser = await puppeteer.launch(LAUNCH_PUPPETEER_OPTS);\n        this.browser = await puppeteer.launch({\n            headless: false,\n            slowMo: 100,\n            // devtools: true\n        });\n    }\n    closeBrowser() {\n        this.browser.close();\n    }\n    async getPageContent(url, selector) {\n        if (!this.browser) {\n            await this.initBrowser();\n        }\n\n        try {\n            const page = await this.browser.newPage();\n            console.log('stage1')\n            await page.goto(url, PAGE_PUPPETEER_OPTS);\n            console.log('stage2')\n            await page.waitForSelector(selector)\n            console.log('stage3')\n            const content = await page.content()\n            page.close()\n            return cheerio.load(content)\n        } catch (err) {\n            throw err;\n        }\n    }\n\n    async getItemsProc(processor, elements) {\n        const processors = []\n        for(let el of elements) {\n            try {\n                const $ = await lib.getPageContent(el.url(processor), el.selector)\n                // const sep = `${el.selector.split('.')[0]}[class=${el.selector.split('.')[1]}]`\n                const arr = el.getItems($, el.selector)\n                processors.push(...arr)\n                // $(el.selector).each(function (i, element) {\n                //     const title = $(element).find(\"a.catalog-product__name>span\").text()\n                //     const link = \"https://dns-shop.ru\" + $(element).find(\"a.catalog-product__name\").attr(\"href\")\n                //     const price = Number($(element).find(\"div.product-buy__price\").text().match(/\\d/gm).join(''))\n                //\n                //     processors.push({\n                //         title, link, price\n                //     })\n                // })\n\n                // const all = $\n                // all.each((i, elem) => {\n                //     const div = $(this).text()\n                //     processors.push(div)\n                // })\n            } catch (e) {\n                console.log('oshibka', e)\n            }\n        }\n        return processors\n    }\n}\n\nconst PAGE_PUPPETEER_OPTS = {\n    networkIdle2Timeout: 5000,\n    waitUntil: 'networkidle2',\n    timeout: 3000000\n};\n\nconst LAUNCH_PUPPETEER_OPTS = {\n    args: [\n        '--no-sandbox',\n        '--disable-setuid-sandbox',\n        '--disable-dev-shm-usage',\n        '--disable-accelerated-2d-canvas',\n        '--disable-gpu',\n        '--window-size=1920x1080'\n    ]\n};\n\nconst lib = new PuppeteerHandler\n\nconst elements = [\n    {\n        url: (processor) => `https://www.dns-shop.ru/catalog/17a899cd16404e77/processory/?order=6&q=${processor}`,\n        selector: \"div.catalog-product\",\n        getItems: function ($, selector) {\n            const processors = []\n            $(selector).each(function (i, element) {\n                const title = $(element).find(\"a.catalog-product__name>span\").text()\n                const link = \"https://dns-shop.ru\" + $(element).find(\"a.catalog-product__name\").attr(\"href\")\n                const price = Number($(element).find(\"div.product-buy__price\").text().match(/\\d/gm).join(''))\n\n                processors.push({\n                    title, link, price\n                })\n            })\n            return processors\n        },\n    },\n    {\n        url: (processor) => `https://www.wildberries.ru/catalog/0/search.aspx?page=1&sort=popular&search=${processor}&fbrand=21223`,\n        selector: \"div.product-card__wrapper\",\n        getItems: function ($, selector) {\n            const processors = []\n            $(selector).each(function (i, element) {\n                const title = $(element).find(\"span.goods-name\").text()\n                const link = $(element).find(\"a.product-card__main\").attr(\"href\")\n                const price = Number($(element).find(\"ins.price__lower-price\").text().match(/\\d/gm).join(''))\n\n                processors.push({\n                    title, link, price\n                })\n            })\n            return processors\n        }\n    },\n    {\n        url: (processor) => `https://www.citilink.ru/search/?text=${processor}&menu_id=26&pf=&f=intel`,\n        selector: \"div.product_data__gtm-js\",\n        getItems: function ($, selector) {\n            const processors = []\n            $(selector).each(function (i, element) {\n              const title = $(element).find(\"a.ProductCardVertical__name\").text()\n              const link = \"https://www.citilink.ru\" + $(element).find(\"a.ProductCardVertical__name\").attr(\"href\")\n              const price = Number($(element).find(\"div.ProductCardVerticalLayout__wrapper-price\").find(\"span.ProductCardVerticalPrice__price-current_current-price\").text().match(/\\d/gm).join(''))\n              processors.push({\n                  title, link, price\n              })\n            })\n            return processors\n        }\n    }\n];"],"mappings":"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"}},"mtime":1675014430535},"{\"assumptions\":{},\"sourceRoot\":\"/Users/vyacheslavsokolov/Dropbox/marketplace_parcer/server/\",\"caller\":{\"name\":\"@babel/node\"},\"cwd\":\"/Users/vyacheslavsokolov/Dropbox/marketplace_parcer/server\",\"filename\":\"/Users/vyacheslavsokolov/Dropbox/marketplace_parcer/server/PuppeteerHandler.js\",\"targets\":{},\"cloneInputAst\":true,\"babelrc\":false,\"configFile\":false,\"browserslistConfigFile\":false,\"passPerPreset\":false,\"envName\":\"development\",\"root\":\"/Users/vyacheslavsokolov/Dropbox/marketplace_parcer/server\",\"rootMode\":\"root\",\"plugins\":[],\"presets\":[]}:7.20.12:development":{"value":{"code":"const puppeteer = require('puppeteer/lib/types');\nconst cheerio = require('cheerio');\nclass PuppeteerHandler {\n  constructor() {\n    this.browser = null;\n  }\n  async initBrowser() {\n    // this.browser = await puppeteer.launch(LAUNCH_PUPPETEER_OPTS);\n    this.browser = await puppeteer.launch({\n      headless: false,\n      slowMo: 100\n      // devtools: true\n    });\n  }\n\n  closeBrowser() {\n    this.browser.close();\n  }\n  async getPageContent(url, selector) {\n    if (!this.browser) {\n      await this.initBrowser();\n    }\n    try {\n      const page = await this.browser.newPage();\n      console.log('stage1');\n      await page.goto(url, PAGE_PUPPETEER_OPTS);\n      console.log('stage2');\n      await page.waitForSelector(selector);\n      console.log('stage3');\n      const content = await page.content();\n      page.close();\n      return cheerio.load(content);\n    } catch (err) {\n      throw err;\n    }\n  }\n  async getItemsProc(processor, elements) {\n    const processors = [];\n    for (let el of elements) {\n      try {\n        const $ = await lib.getPageContent(el.url(processor), el.selector);\n        // const sep = `${el.selector.split('.')[0]}[class=${el.selector.split('.')[1]}]`\n        const arr = el.getItems($, el.selector);\n        processors.push(...arr);\n        // $(el.selector).each(function (i, element) {\n        //     const title = $(element).find(\"a.catalog-product__name>span\").text()\n        //     const link = \"https://dns-shop.ru\" + $(element).find(\"a.catalog-product__name\").attr(\"href\")\n        //     const price = Number($(element).find(\"div.product-buy__price\").text().match(/\\d/gm).join(''))\n        //\n        //     processors.push({\n        //         title, link, price\n        //     })\n        // })\n\n        // const all = $\n        // all.each((i, elem) => {\n        //     const div = $(this).text()\n        //     processors.push(div)\n        // })\n      } catch (e) {\n        console.log('oshibka', e);\n      }\n    }\n    return processors;\n  }\n}\n\n// module.exports = PuppeteerHandler\nexport { PuppeteerHandler };\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJwdXBwZXRlZXIiLCJyZXF1aXJlIiwiY2hlZXJpbyIsIlB1cHBldGVlckhhbmRsZXIiLCJjb25zdHJ1Y3RvciIsImJyb3dzZXIiLCJpbml0QnJvd3NlciIsImxhdW5jaCIsImhlYWRsZXNzIiwic2xvd01vIiwiY2xvc2VCcm93c2VyIiwiY2xvc2UiLCJnZXRQYWdlQ29udGVudCIsInVybCIsInNlbGVjdG9yIiwicGFnZSIsIm5ld1BhZ2UiLCJjb25zb2xlIiwibG9nIiwiZ290byIsIlBBR0VfUFVQUEVURUVSX09QVFMiLCJ3YWl0Rm9yU2VsZWN0b3IiLCJjb250ZW50IiwibG9hZCIsImVyciIsImdldEl0ZW1zUHJvYyIsInByb2Nlc3NvciIsImVsZW1lbnRzIiwicHJvY2Vzc29ycyIsImVsIiwiJCIsImxpYiIsImFyciIsImdldEl0ZW1zIiwicHVzaCIsImUiXSwic291cmNlUm9vdCI6Ii9Vc2Vycy92eWFjaGVzbGF2c29rb2xvdi9Ecm9wYm94L21hcmtldHBsYWNlX3BhcmNlci9zZXJ2ZXIvIiwic291cmNlcyI6WyJQdXBwZXRlZXJIYW5kbGVyLmpzIl0sInNvdXJjZXNDb250ZW50IjpbImNvbnN0IHB1cHBldGVlciA9IHJlcXVpcmUoJ3B1cHBldGVlci9saWIvdHlwZXMnKVxuY29uc3QgY2hlZXJpbyA9IHJlcXVpcmUoJ2NoZWVyaW8nKVxuXG5jbGFzcyBQdXBwZXRlZXJIYW5kbGVyIHtcbiAgICBjb25zdHJ1Y3RvcigpIHtcbiAgICAgICAgdGhpcy5icm93c2VyID0gbnVsbDtcbiAgICB9XG4gICAgYXN5bmMgaW5pdEJyb3dzZXIoKSB7XG4gICAgICAgIC8vIHRoaXMuYnJvd3NlciA9IGF3YWl0IHB1cHBldGVlci5sYXVuY2goTEFVTkNIX1BVUFBFVEVFUl9PUFRTKTtcbiAgICAgICAgdGhpcy5icm93c2VyID0gYXdhaXQgcHVwcGV0ZWVyLmxhdW5jaCh7XG4gICAgICAgICAgICBoZWFkbGVzczogZmFsc2UsXG4gICAgICAgICAgICBzbG93TW86IDEwMCxcbiAgICAgICAgICAgIC8vIGRldnRvb2xzOiB0cnVlXG4gICAgICAgIH0pO1xuICAgIH1cbiAgICBjbG9zZUJyb3dzZXIoKSB7XG4gICAgICAgIHRoaXMuYnJvd3Nlci5jbG9zZSgpO1xuICAgIH1cbiAgICBhc3luYyBnZXRQYWdlQ29udGVudCh1cmwsIHNlbGVjdG9yKSB7XG4gICAgICAgIGlmICghdGhpcy5icm93c2VyKSB7XG4gICAgICAgICAgICBhd2FpdCB0aGlzLmluaXRCcm93c2VyKCk7XG4gICAgICAgIH1cblxuICAgICAgICB0cnkge1xuICAgICAgICAgICAgY29uc3QgcGFnZSA9IGF3YWl0IHRoaXMuYnJvd3Nlci5uZXdQYWdlKCk7XG4gICAgICAgICAgICBjb25zb2xlLmxvZygnc3RhZ2UxJylcbiAgICAgICAgICAgIGF3YWl0IHBhZ2UuZ290byh1cmwsIFBBR0VfUFVQUEVURUVSX09QVFMpO1xuICAgICAgICAgICAgY29uc29sZS5sb2coJ3N0YWdlMicpXG4gICAgICAgICAgICBhd2FpdCBwYWdlLndhaXRGb3JTZWxlY3RvcihzZWxlY3RvcilcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdzdGFnZTMnKVxuICAgICAgICAgICAgY29uc3QgY29udGVudCA9IGF3YWl0IHBhZ2UuY29udGVudCgpXG4gICAgICAgICAgICBwYWdlLmNsb3NlKClcbiAgICAgICAgICAgIHJldHVybiBjaGVlcmlvLmxvYWQoY29udGVudClcbiAgICAgICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICAgICAgICB0aHJvdyBlcnI7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBhc3luYyBnZXRJdGVtc1Byb2MocHJvY2Vzc29yLCBlbGVtZW50cykge1xuICAgICAgICBjb25zdCBwcm9jZXNzb3JzID0gW11cbiAgICAgICAgZm9yKGxldCBlbCBvZiBlbGVtZW50cykge1xuICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICBjb25zdCAkID0gYXdhaXQgbGliLmdldFBhZ2VDb250ZW50KGVsLnVybChwcm9jZXNzb3IpLCBlbC5zZWxlY3RvcilcbiAgICAgICAgICAgICAgICAvLyBjb25zdCBzZXAgPSBgJHtlbC5zZWxlY3Rvci5zcGxpdCgnLicpWzBdfVtjbGFzcz0ke2VsLnNlbGVjdG9yLnNwbGl0KCcuJylbMV19XWBcbiAgICAgICAgICAgICAgICBjb25zdCBhcnIgPSBlbC5nZXRJdGVtcygkLCBlbC5zZWxlY3RvcilcbiAgICAgICAgICAgICAgICBwcm9jZXNzb3JzLnB1c2goLi4uYXJyKVxuICAgICAgICAgICAgICAgIC8vICQoZWwuc2VsZWN0b3IpLmVhY2goZnVuY3Rpb24gKGksIGVsZW1lbnQpIHtcbiAgICAgICAgICAgICAgICAvLyAgICAgY29uc3QgdGl0bGUgPSAkKGVsZW1lbnQpLmZpbmQoXCJhLmNhdGFsb2ctcHJvZHVjdF9fbmFtZT5zcGFuXCIpLnRleHQoKVxuICAgICAgICAgICAgICAgIC8vICAgICBjb25zdCBsaW5rID0gXCJodHRwczovL2Rucy1zaG9wLnJ1XCIgKyAkKGVsZW1lbnQpLmZpbmQoXCJhLmNhdGFsb2ctcHJvZHVjdF9fbmFtZVwiKS5hdHRyKFwiaHJlZlwiKVxuICAgICAgICAgICAgICAgIC8vICAgICBjb25zdCBwcmljZSA9IE51bWJlcigkKGVsZW1lbnQpLmZpbmQoXCJkaXYucHJvZHVjdC1idXlfX3ByaWNlXCIpLnRleHQoKS5tYXRjaCgvXFxkL2dtKS5qb2luKCcnKSlcbiAgICAgICAgICAgICAgICAvL1xuICAgICAgICAgICAgICAgIC8vICAgICBwcm9jZXNzb3JzLnB1c2goe1xuICAgICAgICAgICAgICAgIC8vICAgICAgICAgdGl0bGUsIGxpbmssIHByaWNlXG4gICAgICAgICAgICAgICAgLy8gICAgIH0pXG4gICAgICAgICAgICAgICAgLy8gfSlcblxuICAgICAgICAgICAgICAgIC8vIGNvbnN0IGFsbCA9ICRcbiAgICAgICAgICAgICAgICAvLyBhbGwuZWFjaCgoaSwgZWxlbSkgPT4ge1xuICAgICAgICAgICAgICAgIC8vICAgICBjb25zdCBkaXYgPSAkKHRoaXMpLnRleHQoKVxuICAgICAgICAgICAgICAgIC8vICAgICBwcm9jZXNzb3JzLnB1c2goZGl2KVxuICAgICAgICAgICAgICAgIC8vIH0pXG4gICAgICAgICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ29zaGlia2EnLCBlKVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBwcm9jZXNzb3JzXG4gICAgfVxufVxuXG4vLyBtb2R1bGUuZXhwb3J0cyA9IFB1cHBldGVlckhhbmRsZXJcbmV4cG9ydCB7UHVwcGV0ZWVySGFuZGxlcn0iXSwibWFwcGluZ3MiOiJBQUFBLE1BQU1BLFNBQVMsR0FBR0MsT0FBTyxDQUFDLHFCQUFxQixDQUFDO0FBQ2hELE1BQU1DLE9BQU8sR0FBR0QsT0FBTyxDQUFDLFNBQVMsQ0FBQztBQUVsQyxNQUFNRSxnQkFBZ0IsQ0FBQztFQUNuQkMsV0FBVyxHQUFHO0lBQ1YsSUFBSSxDQUFDQyxPQUFPLEdBQUcsSUFBSTtFQUN2QjtFQUNBLE1BQU1DLFdBQVcsR0FBRztJQUNoQjtJQUNBLElBQUksQ0FBQ0QsT0FBTyxHQUFHLE1BQU1MLFNBQVMsQ0FBQ08sTUFBTSxDQUFDO01BQ2xDQyxRQUFRLEVBQUUsS0FBSztNQUNmQyxNQUFNLEVBQUU7TUFDUjtJQUNKLENBQUMsQ0FBQztFQUNOOztFQUNBQyxZQUFZLEdBQUc7SUFDWCxJQUFJLENBQUNMLE9BQU8sQ0FBQ00sS0FBSyxFQUFFO0VBQ3hCO0VBQ0EsTUFBTUMsY0FBYyxDQUFDQyxHQUFHLEVBQUVDLFFBQVEsRUFBRTtJQUNoQyxJQUFJLENBQUMsSUFBSSxDQUFDVCxPQUFPLEVBQUU7TUFDZixNQUFNLElBQUksQ0FBQ0MsV0FBVyxFQUFFO0lBQzVCO0lBRUEsSUFBSTtNQUNBLE1BQU1TLElBQUksR0FBRyxNQUFNLElBQUksQ0FBQ1YsT0FBTyxDQUFDVyxPQUFPLEVBQUU7TUFDekNDLE9BQU8sQ0FBQ0MsR0FBRyxDQUFDLFFBQVEsQ0FBQztNQUNyQixNQUFNSCxJQUFJLENBQUNJLElBQUksQ0FBQ04sR0FBRyxFQUFFTyxtQkFBbUIsQ0FBQztNQUN6Q0gsT0FBTyxDQUFDQyxHQUFHLENBQUMsUUFBUSxDQUFDO01BQ3JCLE1BQU1ILElBQUksQ0FBQ00sZUFBZSxDQUFDUCxRQUFRLENBQUM7TUFDcENHLE9BQU8sQ0FBQ0MsR0FBRyxDQUFDLFFBQVEsQ0FBQztNQUNyQixNQUFNSSxPQUFPLEdBQUcsTUFBTVAsSUFBSSxDQUFDTyxPQUFPLEVBQUU7TUFDcENQLElBQUksQ0FBQ0osS0FBSyxFQUFFO01BQ1osT0FBT1QsT0FBTyxDQUFDcUIsSUFBSSxDQUFDRCxPQUFPLENBQUM7SUFDaEMsQ0FBQyxDQUFDLE9BQU9FLEdBQUcsRUFBRTtNQUNWLE1BQU1BLEdBQUc7SUFDYjtFQUNKO0VBRUEsTUFBTUMsWUFBWSxDQUFDQyxTQUFTLEVBQUVDLFFBQVEsRUFBRTtJQUNwQyxNQUFNQyxVQUFVLEdBQUcsRUFBRTtJQUNyQixLQUFJLElBQUlDLEVBQUUsSUFBSUYsUUFBUSxFQUFFO01BQ3BCLElBQUk7UUFDQSxNQUFNRyxDQUFDLEdBQUcsTUFBTUMsR0FBRyxDQUFDbkIsY0FBYyxDQUFDaUIsRUFBRSxDQUFDaEIsR0FBRyxDQUFDYSxTQUFTLENBQUMsRUFBRUcsRUFBRSxDQUFDZixRQUFRLENBQUM7UUFDbEU7UUFDQSxNQUFNa0IsR0FBRyxHQUFHSCxFQUFFLENBQUNJLFFBQVEsQ0FBQ0gsQ0FBQyxFQUFFRCxFQUFFLENBQUNmLFFBQVEsQ0FBQztRQUN2Q2MsVUFBVSxDQUFDTSxJQUFJLENBQUMsR0FBR0YsR0FBRyxDQUFDO1FBQ3ZCO1FBQ0E7UUFDQTtRQUNBO1FBQ0E7UUFDQTtRQUNBO1FBQ0E7UUFDQTs7UUFFQTtRQUNBO1FBQ0E7UUFDQTtRQUNBO01BQ0osQ0FBQyxDQUFDLE9BQU9HLENBQUMsRUFBRTtRQUNSbEIsT0FBTyxDQUFDQyxHQUFHLENBQUMsU0FBUyxFQUFFaUIsQ0FBQyxDQUFDO01BQzdCO0lBQ0o7SUFDQSxPQUFPUCxVQUFVO0VBQ3JCO0FBQ0o7O0FBRUE7QUFDQSxTQUFRekIsZ0JBQWdCIn0=","map":{"version":3,"names":["puppeteer","require","cheerio","PuppeteerHandler","constructor","browser","initBrowser","launch","headless","slowMo","closeBrowser","close","getPageContent","url","selector","page","newPage","console","log","goto","PAGE_PUPPETEER_OPTS","waitForSelector","content","load","err","getItemsProc","processor","elements","processors","el","$","lib","arr","getItems","push","e"],"sourceRoot":"/Users/vyacheslavsokolov/Dropbox/marketplace_parcer/server/","sources":["PuppeteerHandler.js"],"sourcesContent":["const puppeteer = require('puppeteer/lib/types')\nconst cheerio = require('cheerio')\n\nclass PuppeteerHandler {\n    constructor() {\n        this.browser = null;\n    }\n    async initBrowser() {\n        // this.browser = await puppeteer.launch(LAUNCH_PUPPETEER_OPTS);\n        this.browser = await puppeteer.launch({\n            headless: false,\n            slowMo: 100,\n            // devtools: true\n        });\n    }\n    closeBrowser() {\n        this.browser.close();\n    }\n    async getPageContent(url, selector) {\n        if (!this.browser) {\n            await this.initBrowser();\n        }\n\n        try {\n            const page = await this.browser.newPage();\n            console.log('stage1')\n            await page.goto(url, PAGE_PUPPETEER_OPTS);\n            console.log('stage2')\n            await page.waitForSelector(selector)\n            console.log('stage3')\n            const content = await page.content()\n            page.close()\n            return cheerio.load(content)\n        } catch (err) {\n            throw err;\n        }\n    }\n\n    async getItemsProc(processor, elements) {\n        const processors = []\n        for(let el of elements) {\n            try {\n                const $ = await lib.getPageContent(el.url(processor), el.selector)\n                // const sep = `${el.selector.split('.')[0]}[class=${el.selector.split('.')[1]}]`\n                const arr = el.getItems($, el.selector)\n                processors.push(...arr)\n                // $(el.selector).each(function (i, element) {\n                //     const title = $(element).find(\"a.catalog-product__name>span\").text()\n                //     const link = \"https://dns-shop.ru\" + $(element).find(\"a.catalog-product__name\").attr(\"href\")\n                //     const price = Number($(element).find(\"div.product-buy__price\").text().match(/\\d/gm).join(''))\n                //\n                //     processors.push({\n                //         title, link, price\n                //     })\n                // })\n\n                // const all = $\n                // all.each((i, elem) => {\n                //     const div = $(this).text()\n                //     processors.push(div)\n                // })\n            } catch (e) {\n                console.log('oshibka', e)\n            }\n        }\n        return processors\n    }\n}\n\n// module.exports = PuppeteerHandler\nexport {PuppeteerHandler}"],"mappings":"AAAA,MAAMA,SAAS,GAAGC,OAAO,CAAC,qBAAqB,CAAC;AAChD,MAAMC,OAAO,GAAGD,OAAO,CAAC,SAAS,CAAC;AAElC,MAAME,gBAAgB,CAAC;EACnBC,WAAW,GAAG;IACV,IAAI,CAACC,OAAO,GAAG,IAAI;EACvB;EACA,MAAMC,WAAW,GAAG;IAChB;IACA,IAAI,CAACD,OAAO,GAAG,MAAML,SAAS,CAACO,MAAM,CAAC;MAClCC,QAAQ,EAAE,KAAK;MACfC,MAAM,EAAE;MACR;IACJ,CAAC,CAAC;EACN;;EACAC,YAAY,GAAG;IACX,IAAI,CAACL,OAAO,CAACM,KAAK,EAAE;EACxB;EACA,MAAMC,cAAc,CAACC,GAAG,EAAEC,QAAQ,EAAE;IAChC,IAAI,CAAC,IAAI,CAACT,OAAO,EAAE;MACf,MAAM,IAAI,CAACC,WAAW,EAAE;IAC5B;IAEA,IAAI;MACA,MAAMS,IAAI,GAAG,MAAM,IAAI,CAACV,OAAO,CAACW,OAAO,EAAE;MACzCC,OAAO,CAACC,GAAG,CAAC,QAAQ,CAAC;MACrB,MAAMH,IAAI,CAACI,IAAI,CAACN,GAAG,EAAEO,mBAAmB,CAAC;MACzCH,OAAO,CAACC,GAAG,CAAC,QAAQ,CAAC;MACrB,MAAMH,IAAI,CAACM,eAAe,CAACP,QAAQ,CAAC;MACpCG,OAAO,CAACC,GAAG,CAAC,QAAQ,CAAC;MACrB,MAAMI,OAAO,GAAG,MAAMP,IAAI,CAACO,OAAO,EAAE;MACpCP,IAAI,CAACJ,KAAK,EAAE;MACZ,OAAOT,OAAO,CAACqB,IAAI,CAACD,OAAO,CAAC;IAChC,CAAC,CAAC,OAAOE,GAAG,EAAE;MACV,MAAMA,GAAG;IACb;EACJ;EAEA,MAAMC,YAAY,CAACC,SAAS,EAAEC,QAAQ,EAAE;IACpC,MAAMC,UAAU,GAAG,EAAE;IACrB,KAAI,IAAIC,EAAE,IAAIF,QAAQ,EAAE;MACpB,IAAI;QACA,MAAMG,CAAC,GAAG,MAAMC,GAAG,CAACnB,cAAc,CAACiB,EAAE,CAAChB,GAAG,CAACa,SAAS,CAAC,EAAEG,EAAE,CAACf,QAAQ,CAAC;QAClE;QACA,MAAMkB,GAAG,GAAGH,EAAE,CAACI,QAAQ,CAACH,CAAC,EAAED,EAAE,CAACf,QAAQ,CAAC;QACvCc,UAAU,CAACM,IAAI,CAAC,GAAGF,GAAG,CAAC;QACvB;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;;QAEA;QACA;QACA;QACA;QACA;MACJ,CAAC,CAAC,OAAOG,CAAC,EAAE;QACRlB,OAAO,CAACC,GAAG,CAAC,SAAS,EAAEiB,CAAC,CAAC;MAC7B;IACJ;IACA,OAAOP,UAAU;EACrB;AACJ;;AAEA;AACA,SAAQzB,gBAAgB"}},"mtime":1675012687170}}